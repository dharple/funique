#!/usr/bin/php -d phar.readonly=0
<?php
// with thanks to: https://blog.programster.org/creating-phar-files

$base = dirname(__DIR__);
$distDir = $base . '/dist';
$pharFile = $distDir . '/funique.phar';

if (!is_dir($distDir)) {
    mkdir($distDir);
}

if (file_exists($pharFile)) {
    unlink($pharFile);
}

$phar = new Phar($pharFile);

$phar->startBuffering();

$defaultStub = $phar->createDefaultStub('bin/funique');

$phar->buildFromDirectory($base, '/^.*\.php/');
$phar->addFile($base . '/bin/funique', 'bin/funique');

$stub = "#!/usr/bin/php \n" . $defaultStub;

$phar->setStub($stub);

$phar->stopBuffering();

$phar->compressFiles(Phar::GZ);

chmod($pharFile, 0755);

echo "$pharFile successfully created" . PHP_EOL;

// vim:ai:cin:et:ts=4:sw=4:fo+=or
