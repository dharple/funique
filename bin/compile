#!/usr/bin/php -d phar.readonly=0
<?php
// with thanks to: https://blog.programster.org/creating-phar-files

$base = dirname(__DIR__);
$distDir = $base . '/dist';
$pharFile = $distDir . '/funique.phar';

if (!is_dir($distDir)) {
    mkdir($distDir);
}

if (file_exists($pharFile)) {
    unlink($pharFile);
}

$phar = new Phar($pharFile);

$phar->convertToExecutable(Phar::PHAR, Phar::GZ);

$phar->startBuffering();

$phar->buildFromDirectory($base, '/^.*\.php/');

$contents = file($base . '/bin/funique');
array_shift($contents);
$phar->addFromString('bin/funique', implode('', $contents));

$phar->setStub("#!/usr/bin/php\n" . $phar->createDefaultStub('bin/funique'));

$phar->stopBuffering();

chmod($pharFile, 0755);

echo "$pharFile successfully created" . PHP_EOL;

// vim:ai:cin:et:ts=4:sw=4:fo+=or
